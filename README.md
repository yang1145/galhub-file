# GalHub 文件管理系统

一个简洁快速的文件管理平台，用于 GalHub 游戏平台的文件分发。

## 功能特性

- 简洁快速的文件列表主页
- 管理员页面支持文件上传和管理
- 独立的文件下载页面
- SQLite 数据库存储文件信息
- 支持文件别名设置
- 文件大小限制为 4GB 以内
- 自动创建文件存储目录
- 管理员账户系统和密码修改功能
- 使用bcrypt加密管理员密码，提高安全性
- 管理员页面具有导航栏菜单，便于操作
- 管理员可以复制文件下载链接

## 技术栈

- Python 3.x
- Flask Web 框架
- SQLite 数据库
- Bcrypt 密码加密
- HTML/CSS/JavaScript 前端界面

## 安装与部署

### 依赖安装

```bash
pip install -r requirements.txt
```

### 运行应用

```bash
python app.py
```

应用默认运行在 `http://127.0.0.1:5000`

## 使用说明

### 访问主页

访问 `http://127.0.0.1:5000` 查看文件列表主页。

### 管理员功能

1. 点击主页右上角的"管理员登录"按钮
2. 输入管理员账户信息登录（默认账户：用户名 `admin`，密码 `admin`）
3. 在管理员面板中可以管理现有文件
4. 使用导航栏在不同功能间切换：
   - 管理员面板：查看和管理文件
   - 上传文件：上传新文件
   - 修改密码：修改管理员密码
   - 退出登录：安全退出系统

### 文件上传

在管理员面板中：
1. 点击导航栏中的"上传文件"链接
2. 点击"选择文件"按钮选择要上传的文件
3. 可选地为文件设置别名
4. 点击"上传"按钮完成上传

### 文件下载

1. 在主页点击文件对应的"下载"链接
2. 在下载页面点击"点击下载"按钮开始下载

### 复制下载链接

在管理员面板中，每个文件都有一个"复制链接"按钮，点击即可将文件的直接下载链接复制到剪贴板。

### 文件删除

在管理员面板中找到要删除的文件，点击"删除"链接并确认。

### 修改管理员密码

1. 登录管理员账户后，点击导航栏中的"修改密码"链接
2. 输入当前密码、新密码和确认新密码
3. 点击"修改密码"按钮完成密码修改

## 数据库结构

文件信息存储在 SQLite 数据库中，包含以下字段：

- `id`: 文件唯一标识符
- `filename`: 文件名
- `alias`: 文件别名（可选）
- `upload_time`: 上传时间（格式化时间字符串）
- `timestamp`: 上传时间戳
- `file_hash`: 文件 SHA256 哈希值

管理员账户信息存储在 admins 表中：
- `id`: 管理员唯一标识符
- `username`: 管理员用户名
- `password_hash`: 管理员密码哈希值（使用bcrypt加密）

## 目录结构

```
galhub-file/
├── app.py              # 主应用文件
├── config.py           # 配置文件
├── requirements.txt    # 依赖列表
├── README.md           # 说明文档
├── files/              # 文件存储目录（自动创建）
├── templates/          # HTML 模板目录
│   ├── index.html      # 主页模板
│   ├── admin.html      # 管理员面板模板
│   ├── upload.html     # 文件上传模板
│   ├── admin_login.html # 管理员登录模板
│   ├── change_password.html # 修改密码模板
│   └── download.html   # 文件下载页面模板
└── files.db            # SQLite 数据库文件（自动创建）
```

## 安全提醒

1. 默认管理员账户为 `admin/admin`，请在首次登录后立即修改密码
2. 应用使用 Flask 开发服务器，仅适用于开发和测试环境
3. 生产环境中应使用专业的 Web 服务器（如 Nginx、Apache）和 WSGI 服务器（如 Gunicorn）
4. 管理员密码使用 bcrypt 加密存储，提供更高的安全性

## 问题修复和改进

### 已修复的问题：

1. **配置一致性**：统一使用 [config.py](file:///d%3A/documents/code/galhub-file/config.py) 中的配置，避免重复定义
2. **错误处理**：增强上传和删除文件功能的错误处理机制
3. **文件冲突检查**：添加了同名文件检查，防止意外覆盖
4. **密码修改验证**：增强密码修改功能的输入验证和错误处理
5. **安全性改进**：修复了密码验证中的一些潜在问题

### 最佳实践：

1. 使用配置文件统一管理应用配置
2. 为关键操作添加异常处理
3. 提供清晰的用户反馈信息
4. 保持代码结构清晰，便于维护

## 配置修改

### 修改默认管理员账户

首次运行应用时会自动创建默认管理员账户。登录后应立即修改密码。

### 修改文件大小限制

在 [config.py](file:///d%3A/documents/code/galhub-file/config.py) 文件中修改以下配置：

```python
MAX_CONTENT_LENGTH = 4 * 1024 * 1024 * 1024  # 4GB limit
```

修改数值以调整文件大小限制。

## 许可证

请参阅 LICENSE 文件。